---
theme: seriph
background: https://source.unsplash.com/collection/94734566/1920x1080
class: 'text-center'
highlighter: shiki
lineNumbers: false
drawings:
    persist: false
css: unocss
---

# 楔子

start

小弥：「之前那个录屏软件咋用，我要录课~」

我：「录啥课，你们不是疫情发视频资料给学生就好了？」

小弥：「那网站不让下，所以只能录屏了」

我：「... 我瞅瞅」

---


# 举个栗子 🌰

现在大多数视频网站为了视频版权保护与加载速度都不会直接使用 MP4 格式的视频资源，进而采用在浏览器端解密播放的视频格式，M3U8 就是比较常见的视频格式。

<br>
<br>
<br>


🌰🌰🌰

- [taobao](https://item.taobao.com/item.htm?spm=a230r.1.14.16.3046293f6PM4vv&id=609798888729&ns=1&abbucket=14)
- [zxx.edu.cn](https://www.zxx.edu.cn/syncClassroom/classActivity?activityId=b87b1ba3-7d58-440d-b5c9-2eb7a7a5faa6)


---

<div grid="~ cols-2 gap-4">

<div>

# M3U8（M3U）格式

> M3U 文件是一种纯文本文件，可以指定一个或多个多媒体文件的位置，其文件扩展名是 “M3U” 或者 “m3u” 。M3U 文件具有多个条目，每个条目的格式可以是以下几种格式之一：
>
> -   一个绝对路径，比如：C:\My Music\Heavysets.mp3
> -   一个相对路径（相对于 M3U 文件的路径），比如：Heavysets.mp3
> -   一个 URL

> M3U8 是 Unicode 版本的 M3U，用 UTF-8 编码。"M3U" 和 "M3U8" 文件都是苹果公司使用的 HTTP Live Streaming 格式的基础，这种格式可以在 iPhone 和 Macbook 等设备播放。

[M3U 维基百科](https://zh.m.wikipedia.org/zh-hans/M3U)

</div>

<div>

# M3U8 示例


```text
#EXTM3U
#EXT-X-VERSION:3
#EXT-X-ALLOW-CACHE:YES
#EXT-X-TARGETDURATION:16
#EXT-X-MEDIA-SEQUENCE:0
#EXTINF:15.366444,
Sw1Nt2Yq6HL4SsaqIEp_248351438042___hd-00001.ts?auth_key=1669086240-0-0-8178ecf4fcca98d45973d9da97793aa2
#EXTINF:8.120000,
Sw1Nt2Yq6HL4SsaqIEp_248351438042___hd-00002.ts?auth_key=1669086240-0-0-a99a49c40ae2511cf0fb679e874852f7
#EXTINF:5.360000,
Sw1Nt2Yq6HL4SsaqIEp_248351438042___hd-00003.ts?auth_key=1669086240-0-0-773af2632be3df442900f8bd4f41a9ac
#EXT-X-ENDLIST

```
</div>

</div>
---


# M3U8 下载解析

<div grid="~ cols-2 gap-4">

<div>


```js
const fs = require('fs-extra');
const path = require('path');
const download = require('download');
const m3u8Parser = require('m3u8-parser');

const M3U8_URL = '';
const OUTPUT_DIR = 'output';
// m3u8 文件下载
const downloadM3u8 = async () => {
    const m3u8OutputPath = path.resolve(__dirname, OUTPUT_DIR, 'index.m3u8');
    await fs.ensureDir(path.resolve(__dirname, OUTPUT_DIR));
    await fs.writeFile(m3u8OutputPath, await download(M3U8_URL));
    return m3u8OutputPath;
};
// m3u8 文件解析
const parseM3u8 = async (filePath) => {
    const m3u8Content = await fs.readFile(filePath, 'utf-8');
    const parser = new m3u8Parser.Parser();
    parser.push(m3u8Content);
    parser.end();
    return parser.manifest;
};
```


</div>

<div>

```json
{
    "allowCache": true,
    "discontinuityStarts": [],
    "segments": [
        {
            "duration": 15.366444,
            "uri": "Sw1Nt2Yq6HL4SsaqIEp_248351438042___hd-00001.ts?auth_key=1669205423-0-0-74779306bc0158d01431cffb432760f0",
            "timeline": 0
        },
        {
            "duration": 8.12,
            "uri": "Sw1Nt2Yq6HL4SsaqIEp_248351438042___hd-00002.ts?auth_key=1669205423-0-0-2663934cc121402f9138e53d3675517b",
            "timeline": 0
        },
        {
            "duration": 5.36,
            "uri": "Sw1Nt2Yq6HL4SsaqIEp_248351438042___hd-00003.ts?auth_key=1669205423-0-0-d556e54b54753b0c115eedea8209b546",
            "timeline": 0
        }
    ],
    "version": 3,
    "targetDuration": 16,
    "mediaSequence": 0,
    "discontinuitySequence": 0,
    "endList": true
}
```



</div>

</div>

---

# M3U8 资源下载

---

# 视频拼接转码

---

# 其他
